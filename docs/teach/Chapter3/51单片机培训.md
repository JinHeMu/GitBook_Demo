# 51单片机培训

[TOC]

## 一. 什么是[单片机](https://baike.baidu.com/item/%E5%8D%95%E7%89%87%E6%9C%BA?fromModule=lemma_search-box)

#### 概念

单片机`（Microcontroller）`是一种集成了处理器核、存储器、输入输出接口和其他外设的**微型计算机系统**。它通常被用于**控制**和执行各种**嵌入式**系统中的任务。

就如同一台能够工作的计算机要有这样几个部份构成： [CPU](# cpu)（ 进行运算、 控制） 、[RAM](# ram)（数据存储） 、 [ROM](#rom)（程序存储） 、 输入/输出设备（例如： 串行口、 并行输出口等） 。 在个人计算机上这些部份被分成若干块芯片， 安装一个称之为主板的印刷线路板上。 而在单片机中， 这些部份全部被做到一块集成电路芯片中了，所以就称为单片机（也称微控制器 **MCU**`(Microprogrammed Control Unit)`）

#### 主要用途

  - 控制：单片机可以根据程序的指令来控制和执行各种操作，如控制外部设备的开关、传感器的采集和处理、运动控制等。它可以根据不同的输入信号和条件来进行逻辑判断和决策，从而实现相应的控制功能。

  - 数据处理：单片机具有处理数据的能力，可以进行各种数学运算、逻辑运算和数据处理操作。它可以接收和处理来自外部设备的数据，进行计算和分析，并根据结果做出相应的响应。
  
  - 存储数据：单片机内部集成了存储器，可以用来存储程序代码、数据和中间结果。这些存储器包括闪存、RAM、EEPROM等。通过存储器，单片机可以保存和读取数据，实现数据的持久化和临时存储。
  
  - 通信：单片机可以通过**串口、SPI、I2C**等通信接口与其他设备进行通信。它可以接收和发送数据，与其他设备进行数据交换和通信，实现信息的传输和共享。
  
  - 时间管理：单片机通常具有定时器和计数器等功能模块，可以进行时间的测量、计时和控制。它可以实现定时触发、周期性任务和时间相关的操作。
  
    

## 二. 51单片机概述

#### 为什么先介绍51单片机

在电子界， 如果想进入微控制器领域的学习， 相信绝大多数的人会认为要从 51 单片机开始。 不错， 在众多微控制器中， 51 单片机确实是非常适合初学者入门学习的， 因此很有必要先认识和了解下 51 单片机  

#### 51系列单片机

51 单片机是对所有兼容 Intel 8031 指令系统的单片机的统称。 该系列单片机的始祖是 Intel 的 8004 单片机， 后来随着 Flash rom 技术的发展， 8004 单片机取得了长足的进展， 成为应用最广泛的 8 位单片机之一， 其代表型号是 ATMEL公司的 AT89 系列， 它广泛应用于工业测控系统之中。  51 单片机是基础入门的一个单片机， 还是应用最广泛的一种。**80C51** 是 MCS-51 系列中的一个典型品种； 其它厂商***以 8051 为基核***开发出的CMOS 工艺单片机产品统称为 80C51 系列。 当前常用的 80C51 系列单片机主要产品有：

- Intel(英特尔)的： 80C31、 80C51、 87C51， 80C32、 80C52、 87C52 等；

- ATMEL(艾德梅尔)的： 89C51、 89C52、89C2051， 89S51（RC） ， 89S52（RC）；

  初学者一般使用最多的就是STC89C52RC这一型号。
  
  

## 三. 51单片机硬件结构


#### CPU{#cpu}和[寄存器](https://baike.baidu.com/item/)  

  - CPU类似于一个小型计算机的中央处理器。它包含了一组寄存器，负责执行指令和处理数据。

    

#### 存储器（RAM、ROM等）
##### 			**RAM**(Random Access Memory):{#ram}
随机存取存储器，是计算机内部存储器中的一种，可以理解为**运行内存**。<u>特点：掉电丢失数据</u>




##### 	    	**ROM**(Read Only Memory):{#rom}

ROM全称Read Only Memory，顾名思义，它是一种只能读出事先所存的数据的固态半导体存储器。ROM中所存数据稳定，一旦存储数据就再也无法将之改变或者删除，断电后所存数据也不会消失。其结构简单，因而常用于存储各种固化程序和数据。特点：<u>掉电不丢失数据</u>




#### I/O口和引脚布局(封装)

- I/O口（输入/输出口）是51单片机中用于连接外部设备的接口。它们允许单片机与外部世界进行数据交换和通信。每个I/O口都对应一个或多个引脚，用于输入和输出数据信号。

- 常见的引脚布局包括**DIP**（双列直插式封装）和**QFP**（四边形扁平封装）等。DIP封装的单片机引脚通常以两列排列，每一列有若干个引脚。QFP封装的单片机引脚则以四边形的形式排列在芯片的底部。

    ![164440o41v6r4z4rt4ts2q.png (525×536)](http://c.51hei.com/d/forum/201712/12/164440o41v6r4z4rt4ts2q.png)

​																			51单片机引脚分布


![51单片机 - 搜狗百科](https://ts1.cn.mm.bing.net/th/id/R-C.4948691da984fc0724d1f877885203f4?rik=Hi4Gfb5e7jRYyA&riu=http%3a%2f%2fpic.baike.soso.com%2fp%2f20140318%2f20140318130748-986860524.jpg&ehk=jTmaeep%2f5v6smtDZUBph77f%2bdkLmcgbqV7TAEFZP1%2bM%3d&risl=&pid=ImgRaw&r=0&sres=1&sresct=1)

​																	DIP封装的51单片机




#### 定时器和计数器

- 定时器是一个特殊的计数器，它可以在给定的时间间隔内自动递增。定时器通常由一个内部**振荡器**提供时钟信号，以固定的频率进行计数。当定时器达到设定的计数值时，会触发一个**中断**或产生一个特定的输出信号。
- 计数器是一个用于计数外部事件或**脉冲信号**的模块。它可以记录外部事件的数量或频率，并根据需要进行进一步的处理。计数器可以通过外部引脚接收脉冲信号，并在每个脉冲到达时递增计数值。

#### 中断系统

- 中断系统，可以在特定条件下中断当前程序的执行，处理某些紧急事件或外部输入，处理完成后，再继续干之前的事情。就好比你正在写作业，这是突然有人给你打了个微信电话，然后你就中断当前所在做的事情，转而去执行另外的事情，当这件事处理完后，你再继续写你的作业。
- 举例：假设我们有一个外部中断INT0，当外部触发信号到达时，它会中断当前程序的执行，跳转到中断服务程序中执行特定的操作。

![中断&定时器（二）_G.R.I.T.的博客-CSDN博客](https://img-blog.csdnimg.cn/img_convert/daf264a3945cfadb190e1e062b4afa68.png)

​																			中断示意图

## 四. 单片机最小系统

#### [晶振]([什么是晶振？晶振在电路中的作用是什么？_晶振的作用-CSDN博客](https://blog.csdn.net/Naiva/article/details/98961896))电路

晶振就像交通灯的时间计数一样，如果时间停止了，交通灯信号也不切换了，就僵死在那里。

数字电路都是按节拍来进行处理的,而晶振就是提供这个节拍的，如果没有了晶振，也就没有了节拍，那也就不能处理任何数据了。我们现在说CPU**主频**是多少，其实这个主频就相当于单片机上面的晶振。

#### 复位电路

  晶振犹如人的心脏， 需要无时无刻给单片机提供运行周期。 但即使时钟周期在不停的运行， 系统也有可能会出现崩溃或者瘫痪状态。 这就好比人会生病一样， 人一生病就得看医生， 服用医生开的药后重新获得正常状态。 那么单片机呢， 它是如何获取重生的？ 这就需要设计一个复位电路来实现此功能。 单片机引脚当中就有一个 RST 复位引脚， 而 <u>STC89CXX 单片机又是高电平复位</u>， 所以只需要让这个引脚保持一段时间高电平就可以。 要实现此功能通常有两种方式， 一种是通过按键进行**手动复位**，还有一种是**上电复位**， 即电源开启后自动复位。 

  - 手动复位是通过一个按键及电容电阻所组成， 利用按键的开关功能实现复位， 按键按下后 VCC 直接进入到单片机RST 引脚， 松开后 VCC 断开， RST 被电阻拉为低电平。 这一合一开就实现了手动复位。 
  - 而自动复位主要是利用 RC 充放电功能， 电源已开启， 由于电容隔直， VCC直接进入 RST， 然后电容开始慢慢充电， 直到充电完成， 此时 RST 被电阻拉低。这样就起到上电复位的效果。 这里我们采用手动复位。 不到系统崩溃， 我们几乎不会操作复位。

#### 电源电路
STC89CXX 单片机的工作电压是 3.3-5.5V 范围，
通常我们使用 5V 直流。

#### 下载电路

顾名思义，将需要执行的程序下载（**烧录**）到单片机中运行。要烧写到单片机内是通过电脑 及对应的软件将编译器生成的 **.HEX 文件**通过单片机串口写入进去。
使用 USB 转 TTL 串口电平芯片来建立 PC 机和单片机数据传输通路。 

## 五. 51单片机的编程语言及开发工具

#### 编程语言

单片机的编程语言有三种：机器语言、汇编语言和高级语言。其中高级语言中，单片机一般使用C语言，因为C语言代码执行效率高，比较精简，便于移植，所以它在现今的单片机编程语言中占据了绝对的**主导地位**。

- C语言：绝大多数情况下单片机程序开发采用c语言。
- 汇编语言（仅作了解）：程序执行效率高，占用资源少， 方便对最底层的一些东西进行操作，一般用于底层开发。

#### 开发工具

- Keil5:

本质是一个**集成开发环境**（[IDE]([集成开发环境_百度百科 (baidu.com)](https://baike.baidu.com/item/集成开发环境/298524))），用于编写和调试嵌入式系统的程序。Keil5是Keil公司推出的最新版本，支持多种单片机系列。

- stc-isp:

STC-ISP是一种用于烧录STC系列单片机的烧录软件。STC单片机是一种常见的51单片机兼容芯片，STC-ISP可以通过串口或USB接口与单片机进行通信，实现程序的烧录和调试。

## 六. 实例讲解

#### 1.搭建实际电路

在前期若使用的是51单片机**开发板**，那么板子上面已经加上了一些用于演示的电路，如LED模块，蜂鸣器模块等，方便初学者学习以演示现象。

当然我们也可以在最小系统板的基础上自行搭建外围电路，可以达到同样的效果。



#### 2.编写程序

搭建好实际电路后，我们就可根据需求来编写对应程序了。

```c 
//例1  点亮一个LED
#include <REGX52.H>	//包含51单片机的寄存器定义文件，如下面用到的寄存器P2,就源自<REGX52.H>

void main()
{
    //P2是一个特殊功能寄存器的名称
	P2=0xfe;	//以0x开头的表示16进制，转化为二进制为：1111 1110
	while(1)
	{
	
	}
}
```

在前面的基础上，加上一个延时函数，就可以实现LED的交替亮灭：

```c
//例2  LED闪灭
#include <REGX52.H>  // 包含51单片机的寄存器定义文件
#include <INTRINS.H>  // 包含一些内置函数,如这里的_nop_()函数

//延时函数
void Delay300ms()
{
    unsigned char i, j, k;
    _nop_();  		// 空语句，延时
    i = 3;
    j = 72;
    k = 161;
    do
    {
        do
        {
            while (--k);  
        } while (--j);  	
    } while (--i);  	
}

void main()      // 程序入口
{
    while(1)	 // 主循环，用以循环执行主程序中的核心代码
    {
        P2=0xfe; // 将P2口的值设置为0xfe，即二进制11111110，其中最低位为0，其它位为1，将 P2 口的最低位引脚输出低电平，其他引脚输出高电平，点亮最低位的灯泡
        Delay300ms();	
        P2=0xff; // 将P2口的值设置为0xff，即二进制11111111，所有位都为1，关闭最低位的灯泡
        Delay300ms();	
    }
}

```

#### 3.下载程序

在确认程序逻辑正确无误后，通过烧录软件把编译器生成的hex文件烧录到单片机中，给单片机供电并复位，观察实际现象与期望现象是否一样，若不相符，则回过头检查搭建的电路以及代码，直至单片机控制程序正确运行。







